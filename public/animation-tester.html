<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation Tester - Road of War</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
        }

        .header {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        h1 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        button:hover {
            background: #45a049;
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
        }

        .test-results {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .test-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
        }

        .summary-card.error {
            border-left-color: #f44336;
        }

        .summary-card.warning {
            border-left-color: #ffaa00;
        }

        .summary-label {
            color: #bbb;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .summary-value {
            color: #4CAF50;
            font-size: 24px;
            font-weight: bold;
        }

        .summary-value.error {
            color: #f44336;
        }

        .summary-value.warning {
            color: #ffaa00;
        }

        .test-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .test-table th,
        .test-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #444;
        }

        .test-table th {
            background: #333;
            color: #4CAF50;
            font-weight: bold;
        }

        .test-table tr:hover {
            background: #333;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-badge.valid {
            background: #2a4a2a;
            color: #4CAF50;
        }

        .status-badge.invalid {
            background: #4a2a2a;
            color: #f44336;
        }

        .error-list {
            color: #ffaaaa;
            font-size: 12px;
            margin-top: 5px;
        }

        .warning-list {
            color: #ffdd88;
            font-size: 12px;
            margin-top: 5px;
        }

        .connection-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .connection-status.connected {
            background: #4CAF50;
        }

        .connection-status.disconnected {
            background: #f44336;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ§ª Animation Tester</h1>
        <div>
            <span class="connection-status" id="connectionStatus"></span>
            <span id="connectionText">Connecting to game...</span>
        </div>
        <div class="controls">
            <button id="testAllBtn">Test All Animations</button>
            <button id="testCharacterBtn">Test Character Type</button>
            <select id="characterTypeSelect">
                <option value="">Select Character Type...</option>
            </select>
            <button id="exportBtn">Export Results</button>
        </div>
    </div>

    <div class="test-results" id="testResults" style="display: none;">
        <h2>Test Results</h2>
        <div class="test-summary" id="testSummary"></div>
        <table class="test-table" id="testTable">
            <thead>
                <tr>
                    <th>Animation Key</th>
                    <th>Status</th>
                    <th>Frame Count</th>
                    <th>Frame Rate</th>
                    <th>Errors</th>
                    <th>Warnings</th>
                </tr>
            </thead>
            <tbody id="testTableBody"></tbody>
        </table>
    </div>

    <script>
        let gameScene = null;
        let testResults = null;

        // Check connection
        function checkConnection() {
            let scene = null;
            
            if (window.game && window.gameScene) {
                scene = window.gameScene;
            } else if (window.game && window.game.scene) {
                scene = window.game.scene.getScene('GameScene');
                if (scene) window.gameScene = scene;
            } else if (window.parent && window.parent !== window) {
                if (window.parent.game && window.parent.gameScene) {
                    scene = window.parent.gameScene;
                } else if (window.parent.game && window.parent.game.scene) {
                    scene = window.parent.game.scene.getScene('GameScene');
                }
            }
            
            if (scene && scene.animationManager) {
                gameScene = scene;
                document.getElementById('connectionStatus').className = 'connection-status connected';
                document.getElementById('connectionText').textContent = 'Connected to game';
                loadCharacterTypes();
                return true;
            } else {
                document.getElementById('connectionStatus').className = 'connection-status disconnected';
                document.getElementById('connectionText').textContent = 'Not connected - Make sure game is running and GameScene is loaded';
                return false;
            }
        }

        // Load character types
        function loadCharacterTypes() {
            if (!gameScene || !gameScene.anims) return;

            const select = document.getElementById('characterTypeSelect');
            const types = new Set();

            for (const key of Object.keys(gameScene.anims.anims.entries)) {
                const parts = key.split('-');
                if (parts.length >= 2) {
                    types.add(parts[0]);
                }
            }

            select.innerHTML = '<option value="">Select Character Type...</option>';
            for (const type of Array.from(types).sort()) {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                select.appendChild(option);
            }
        }

        // Test all animations
        function testAllAnimations() {
            if (!gameScene || !gameScene.anims) return;

            const allAnims = Object.keys(gameScene.anims.anims.entries);
            runTests(allAnims);
        }

        // Test character type
        function testCharacterType(characterType) {
            if (!gameScene || !gameScene.anims || !characterType) return;

            const anims = [];
            for (const key of Object.keys(gameScene.anims.anims.entries)) {
                if (key.startsWith(`${characterType}-`)) {
                    anims.push(key);
                }
            }

            runTests(anims);
        }

        // Run tests
        function runTests(animKeys) {
            if (!gameScene || !gameScene.animationManager) {
                alert('Animation manager not available');
                return;
            }

            // Use validator if available
            let validator = null;
            if (gameScene.animationManager.validator) {
                validator = gameScene.animationManager.validator;
            } else if (gameScene.animationManager.debugger) {
                // Fallback to debugger
                validator = {
                    validateAnimation: (key) => {
                        const inspection = gameScene.animationManager.debugger.inspectAnimation(key);
                        return {
                            animKey: key,
                            valid: inspection.errors.length === 0,
                            errors: inspection.errors,
                            warnings: inspection.warnings,
                            info: {
                                frameCount: inspection.frameCount,
                                frameRate: inspection.frameRate
                            }
                        };
                    }
                };
            } else {
                alert('No validator available');
                return;
            }

            const results = [];
            const summary = {
                total: animKeys.length,
                valid: 0,
                invalid: 0,
                errors: 0,
                warnings: 0
            };

            for (const animKey of animKeys) {
                const result = validator.validateAnimation(animKey);
                results.push(result);

                if (result.valid) {
                    summary.valid++;
                } else {
                    summary.invalid++;
                }
                summary.errors += result.errors.length;
                summary.warnings += result.warnings.length;
            }

            testResults = { summary, results };
            displayResults(testResults);
        }

        // Display results
        function displayResults(results) {
            document.getElementById('testResults').style.display = 'block';

            // Summary
            const summaryDiv = document.getElementById('testSummary');
            summaryDiv.innerHTML = `
                <div class="summary-card">
                    <div class="summary-label">Total Animations</div>
                    <div class="summary-value">${results.summary.total}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Valid</div>
                    <div class="summary-value">${results.summary.valid}</div>
                </div>
                <div class="summary-card error">
                    <div class="summary-label">Invalid</div>
                    <div class="summary-value error">${results.summary.invalid}</div>
                </div>
                <div class="summary-card warning">
                    <div class="summary-label">Total Errors</div>
                    <div class="summary-value warning">${results.summary.errors}</div>
                </div>
                <div class="summary-card warning">
                    <div class="summary-label">Total Warnings</div>
                    <div class="summary-value warning">${results.summary.warnings}</div>
                </div>
            `;

            // Table
            const tbody = document.getElementById('testTableBody');
            tbody.innerHTML = '';

            for (const result of results.results) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.animKey}</td>
                    <td>
                        <span class="status-badge ${result.valid ? 'valid' : 'invalid'}">
                            ${result.valid ? 'Valid' : 'Invalid'}
                        </span>
                    </td>
                    <td>${result.info.frameCount || 0}</td>
                    <td>${result.info.frameRate || 0}</td>
                    <td>
                        ${result.errors.length > 0 ? `
                            <div class="error-list">
                                ${result.errors.map(e => `â€¢ ${e}`).join('<br>')}
                            </div>
                        ` : '-'}
                    </td>
                    <td>
                        ${result.warnings.length > 0 ? `
                            <div class="warning-list">
                                ${result.warnings.map(w => `â€¢ ${w}`).join('<br>')}
                            </div>
                        ` : '-'}
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // Export results
        function exportResults() {
            if (!testResults) {
                alert('No test results to export');
                return;
            }

            const blob = new Blob([JSON.stringify(testResults, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `animation-test-results-${Date.now()}.json`;
            a.click();
        }

        // Event listeners
        document.getElementById('testAllBtn').onclick = testAllAnimations;
        document.getElementById('testCharacterBtn').onclick = () => {
            const type = document.getElementById('characterTypeSelect').value;
            if (type) {
                testCharacterType(type);
            } else {
                alert('Please select a character type');
            }
        };
        document.getElementById('exportBtn').onclick = exportResults;

        // Initialize
        checkConnection();
        setInterval(checkConnection, 2000);
    </script>
</body>
</html>

